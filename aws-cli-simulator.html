<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AWS CLI Scavenger Hunt</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Courier New', monospace;
            background-color: #1e1e1e;
            color: #ffffff;
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .terminal {
            width: 100%;
            max-width: 1000px;
            height: 80vh;
            background-color: #2d2d2d;
            border-radius: 10px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .terminal-header {
            background-color: #3c3c3c;
            padding: 10px 15px;
            display: flex;
            align-items: center;
            border-radius: 10px 10px 0 0;
        }

        .window-controls {
            display: flex;
            gap: 8px;
        }

        .control {
            width: 12px;
            height: 12px;
            border-radius: 50%;
        }

        .control.red { background-color: #ff5f56; }
        .control.yellow { background-color: #ffbd2e; }
        .control.green { background-color: #27ca3f; }

        .terminal-title {
            margin-left: 15px;
            font-size: 14px;
            color: #cccccc;
        }

        .terminal-body {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
        }

        .output {
            flex: 1;
            margin-bottom: 20px;
            line-height: 1.4;
        }

        .command-line {
            margin-bottom: 10px;
        }

        .prompt {
            color: #4CAF50;
            font-weight: bold;
        }

        .user-input {
            color: #ffffff;
        }

        .aws-output {
            color: #e0e0e0;
            margin-left: 0;
            white-space: pre-wrap;
        }

        .error {
            color: #ff6b6b;
        }

        .success {
            color: #4CAF50;
        }

        .clue {
            color: #ffd93d;
            font-weight: bold;
        }

        .input-container {
            display: flex;
            align-items: center;
        }

        .input-prompt {
            color: #4CAF50;
            font-weight: bold;
            margin-right: 10px;
        }

        #command-input {
            flex: 1;
            background: transparent;
            border: none;
            color: #ffffff;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            outline: none;
        }

        .json-output {
            color: #87CEEB;
        }

        .congratulations {
            color: #ffd93d;
            font-weight: bold;
            text-align: center;
            margin: 20px 0;
        }

        .reset-button {
            background-color: #4CAF50;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-family: 'Courier New', monospace;
            margin: 10px auto;
            display: block;
        }

        .reset-button:hover {
            background-color: #45a049;
        }
    </style>
</head>
<body>
    <div class="terminal">
        <div class="terminal-header">
            <div class="window-controls">
                <div class="control red"></div>
                <div class="control yellow"></div>
                <div class="control green"></div>
            </div>
            <div class="terminal-title">AWS CLI Scavenger Hunt</div>
        </div>
        <div class="terminal-body">
            <div class="output" id="output">
                <div class="clue">üîç Welcome to the AWS CLI Scavenger Hunt! üîç</div>
                <div class="aws-output">
Your mission: Navigate through AWS services using CLI commands to find hidden clues.
Each correct command will reveal the next step in your journey.

<span class="clue">Clue 1: The S3 Riddle</span>
Three buckets hold the key, but only one contains what you seek.
List the S3 buckets to begin your quest...
                </div>
            </div>
            <div class="input-container">
                <span class="input-prompt">user@cli-hunt:~$</span>
                <input type="text" id="command-input" autocomplete="off" autofocus>
            </div>
        </div>
    </div>

    <script>
        let currentClue = 0;
        const output = document.getElementById('output');
        const commandInput = document.getElementById('command-input');

        // Game data structure
        const gameStages = [
            {
                expectedCommand: 'aws s3 ls',
                output: `2023-08-19 12:34:56 my-app-bucket
2023-08-19 12:35:12 clue-bucket-1
2023-08-19 12:35:28 backup-storage-bucket`,
                nextClue: `<span class="clue">Clue 2: The S3 File</span>
I see you found the clue-bucket-1! Now look inside it.
What secrets does this bucket contain?`
            },
            {
                expectedCommand: 'aws s3 ls s3://clue-bucket-1',
                output: `2023-08-19 12:36:45        156 clue.txt`,
                nextClue: `<span class="clue">Clue 3: The Hidden Message</span>
A single file awaits! Download it to reveal the next step.
(Hint: You can use 'aws s3 cp' or 'cat' to read the contents)`
            },
            {
                expectedCommand: ['aws s3 cp s3://clue-bucket-1/clue.txt .', 'cat clue.txt', 'aws s3 cp s3://clue-bucket-1/clue.txt'],
                output: `Found it! Your next clue is hidden in the SSM Parameter Store.
The parameter name is: /scavenger-hunt/clue-2

Look for the secret that holds the identity of a hidden user...`,
                nextClue: `<span class="clue">Clue 4: The SSM Secret</span>
The Systems Manager Parameter Store holds many secrets.
Retrieve the parameter to discover the next piece of the puzzle!`
            },
            {
                expectedCommand: 'aws ssm get-parameter --name /scavenger-hunt/clue-2',
                output: `{
    "Parameter": {
        "Name": "/scavenger-hunt/clue-2",
        "Type": "String",
        "Value": "arn:aws:iam::123456789012:user/the-hidden-user",
        "Version": 1,
        "LastModifiedDate": "2023-08-19T12:40:00.000000+00:00",
        "ARN": "arn:aws:ssm:us-east-1:123456789012:parameter/scavenger-hunt/clue-2"
    }
}`,
                nextClue: `<span class="clue">Clue 5: The IAM Identity</span>
You've discovered the ARN of a hidden user: 'the-hidden-user'
What policies are attached to this mysterious identity?`
            },
            {
                expectedCommand: 'aws iam list-attached-user-policies --user-name the-hidden-user',
                output: `{
    "AttachedPolicies": [
        {
            "PolicyName": "ScavengerHuntPolicy",
            "PolicyArn": "arn:aws:iam::123456789012:policy/ScavengerHuntPolicy"
        }
    ]
}`,
                nextClue: `<span class="clue">Final Clue: The Policy Document</span>
One last step! Examine the policy document to complete your quest.
Get the policy version to reveal the final secret!`
            },
            {
                expectedCommand: 'aws iam get-policy-version --policy-arn arn:aws:iam::123456789012:policy/ScavengerHuntPolicy --version-id v1',
                output: `{
    "PolicyVersion": {
        "Document": {
            "Version": "2012-10-17",
            "Statement": [
                {
                    "Effect": "Allow",
                    "Action": "s3:GetObject",
                    "Resource": "arn:aws:s3:::treasure-bucket/*",
                    "Condition": {
                        "StringEquals": {
                            "s3:ExistingObjectTag/SecretCode": "CONGRATULATIONS_HUNTER_2023"
                        }
                    }
                }
            ]
        },
        "VersionId": "v1",
        "IsDefaultVersion": true,
        "CreateDate": "2023-08-19T12:45:00.000000+00:00"
    }
}`,
                nextClue: null,
                isComplete: true
            }
        ];

        function addToOutput(content, className = '') {
            const div = document.createElement('div');
            div.className = `command-line ${className}`;
            div.innerHTML = content;
            output.appendChild(div);
            scrollToBottom();
        }

        function scrollToBottom() {
            output.scrollTop = output.scrollHeight;
        }

        function processCommand(command) {
            // Add user command to output
            addToOutput(`<span class="prompt">user@cli-hunt:~$</span> <span class="user-input">${command}</span>`);

            if (currentClue >= gameStages.length) {
                addToOutput('Game completed! Refresh the page to play again.', 'error');
                return;
            }

            const currentStage = gameStages[currentClue];
            let commandMatches = false;

            // Check if command matches expected command(s)
            if (Array.isArray(currentStage.expectedCommand)) {
                commandMatches = currentStage.expectedCommand.some(cmd => 
                    command.trim().toLowerCase() === cmd.toLowerCase()
                );
            } else {
                commandMatches = command.trim().toLowerCase() === currentStage.expectedCommand.toLowerCase();
            }

            if (commandMatches) {
                // Correct command - show output
                addToOutput(`<span class="aws-output json-output">${currentStage.output}</span>`);
                
                if (currentStage.isComplete) {
                    // Game completed
                    addToOutput(`
<div class="congratulations">
üéâ CONGRATULATIONS! üéâ
You've successfully completed the AWS CLI Scavenger Hunt!

You discovered the secret code: CONGRATULATIONS_HUNTER_2023

You've mastered the art of AWS CLI navigation and uncovered all the hidden clues.
Well done, Cloud Detective! üïµÔ∏è‚Äç‚ôÇÔ∏è
</div>`, 'success');
                    
                    const resetBtn = document.createElement('button');
                    resetBtn.className = 'reset-button';
                    resetBtn.textContent = 'Start New Hunt';
                    resetBtn.onclick = resetGame;
                    output.appendChild(resetBtn);
                } else {
                    // Show next clue
                    if (currentStage.nextClue) {
                        addToOutput(`<span class="aws-output">${currentStage.nextClue}</span>`);
                    }
                    currentClue++;
                }
            } else {
                // Incorrect command
                addToOutput(`aws: error: argument operation: Invalid choice, valid choices are:

Common AWS CLI commands for this hunt:
‚Ä¢ aws s3 ls [bucket-name]
‚Ä¢ aws s3 cp <source> <destination>
‚Ä¢ aws ssm get-parameter --name <parameter-name>
‚Ä¢ aws iam list-attached-user-policies --user-name <username>
‚Ä¢ aws iam get-policy-version --policy-arn <arn> --version-id <version>

Try again with the correct command for your current clue!`, 'error');
            }
        }

        function resetGame() {
            currentClue = 0;
            output.innerHTML = `
                <div class="clue">üîç Welcome to the AWS CLI Scavenger Hunt! üîç</div>
                <div class="aws-output">
Your mission: Navigate through AWS services using CLI commands to find hidden clues.
Each correct command will reveal the next step in your journey.

<span class="clue">Clue 1: The S3 Riddle</span>
Three buckets hold the key, but only one contains what you seek.
List the S3 buckets to begin your quest...
                </div>
            `;
            commandInput.focus();
        }

        // Event listeners
        commandInput.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                const command = commandInput.value.trim();
                if (command) {
                    processCommand(command);
                    commandInput.value = '';
                }
            }
        });

        // Focus input when clicking anywhere in terminal
        document.querySelector('.terminal-body').addEventListener('click', function() {
            commandInput.focus();
        });

        // Ensure input stays focused
        commandInput.addEventListener('blur', function() {
            setTimeout(() => commandInput.focus(), 100);
        });
    </script>
</body>
</html>
